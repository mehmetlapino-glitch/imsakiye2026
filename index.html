<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global İmsakiye 2026</title>
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="data:application/json;base64,ewogICJkZWZhdWx0X2xvY2FsZSI6ICJ0ciIsCiAgIm5hbWUiOiAiR2xvYmFsIEltc2FraXllIiwKICAic2hvcnRfbmFtZSI6ICJJbXFraXllIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmOGZhZmMiLAogICJ0aGVtZV9jb2xvciI6ICIxZTNhOGEiCn0=">

    <style>
        :root { --primary: #1e3a8a; --accent: #10b981; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 10px; box-sizing: border-box;}
        .card { background: white; width: 100%; max-width: 450px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; position: relative;}
        
        .lang-bar { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .lang-btn { cursor: pointer; border: 1px solid #ddd; background: none; padding: 5px 12px; border-radius: 8px; font-weight: bold; font-size: 0.8rem; }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .search-container { position: relative; margin-bottom: 20px; }
        .search-box { display: flex; gap: 5px; }
        .search-box input { flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; outline: none; }
        .search-box button { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-weight: bold; }

        .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; z-index: 100; border-radius: 0 0 10px 10px; display: none; text-align: left; max-height: 150px; overflow-y: auto; }
        .suggestion-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; }

        .countdown-area { background: #eff6ff; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        #countdown-label { font-size: 0.95rem; color: #1e40af; font-weight: bold; margin-bottom: 5px; }
        #timer { font-size: 2.2rem; font-weight: bold; color: var(--primary); font-variant-numeric: tabular-nums; }

        .vakit-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .vakit-item { background: #f1f5f9; padding: 15px; border-radius: 15px; border-bottom: 4px solid var(--accent); }
        .vakit-time { font-size: 1.6rem; font-weight: bold; }

        .hadith-area { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 15px; text-align: left; border-radius: 0 10px 10px 0; margin-top: 10px; }
        .hadith-text { font-style: italic; color: #451a03; line-height: 1.5; margin: 8px 0; font-size: 0.95rem; }
        [dir="rtl"] .hadith-area { text-align: right; border-left: none; border-right: 4px solid #f59e0b; border-radius: 10px 0 0 10px; }
        
        #install-banner { display: none; background: #334155; color: white; padding: 10px; border-radius: 10px; margin-bottom: 15px; justify-content: space-between; align-items: center; font-size: 0.85rem; }
        #install-banner button { background: var(--accent); border: none; color: white; padding: 5px 12px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="card" id="app">
    <div id="install-banner">
        <span id="txt-install">Uygulamayı Yükle</span>
        <button onclick="installApp()" id="btn-install-action">Ekle</button>
    </div>

    <div class="lang-bar">
        <button class="lang-btn active" onclick="setLang('tr')">TR</button>
        <button class="lang-btn" onclick="setLang('en')">EN</button>
        <button class="lang-btn" onclick="setLang('ar')">AR</button>
        <button class="lang-btn" onclick="setLang('fr')">FR</button>
    </div>

    <div class="search-container">
        <div class="search-box">
            <input type="text" id="city-input" placeholder="Şehir..." oninput="handleInput(this.value)" autocomplete="off">
            <button onclick="searchCity()" id="btn-search">Ara</button>
        </div>
        <div id="suggestions" class="suggestions"></div>
    </div>

    <h2 id="display-city">...</h2>

    <div class="countdown-area">
        <div id="countdown-label">Vakit Hesaplanıyor...</div>
        <div id="timer">00:00:00</div>
    </div>

    <div class="vakit-grid">
        <div class="vakit-item">
            <div id="lbl-sahur">Sahur</div>
            <div class="vakit-time" id="time-fajr">--:--</div>
        </div>
        <div class="vakit-item">
            <div id="lbl-iftar">İftar</div>
            <div class="vakit-time" id="time-maghrib">--:--</div>
        </div>
    </div>

    <div class="hadith-area">
        <strong id="lbl-hadith-title">Günün Hadisi</strong>
        <div id="hadith-text" class="hadith-text">...</div>
        <small style="color: #92400e;">Source: Bukhari & Muslim</small>
    </div>
</div>

<script>
    // 30 Günlük Hadis Veritabanı (Örnek olarak 5 tanesi dolduruldu, aynı mantıkla 30'a tamamlanabilir)
    const hadithList = [
        {
            tr: "Ameller niyetlere göredir. Herkes niyet ettiği şeyin karşılığını alır.",
            en: "Actions are but by intentions and every man shall have only that which he intended.",
            ar: "إنما الأعمال بالنيات، وإنما لكل امرئ ما نوى",
            fr: "Les actions ne valent que par les intentions et chacun n'aura que ce qu'il a l'intention de faire."
        },
        {
            tr: "Müslüman, dilinden ve elinden insanların güvende olduğu kişidir.",
            en: "A Muslim is the one from whose tongue and hand the people are safe.",
            ar: "المسلم من سلم الناس من لسانه ويده",
            fr: "Le Musulman est celui dont les gens n'ont à redouter ni sa langue ni sa main."
        },
        {
            tr: "Kolaylaştırın, zorlaştırmayın; müjdeleyin, nefret ettirmeyin.",
            en: "Make things easy and do not make them difficult, cheer people up and do not repel them.",
            ar: "يسروا ولا تعسروا وبشروا ولا تنفروا",
            fr: "Facilitez les choses et ne les rendez pas difficiles; annoncez de bonnes nouvelles et ne rebutez pas les gens."
        },
        {
            tr: "Sizin en hayırlınız, ahlakı en güzel olanınızdır.",
            en: "The best among you are those who have the best manners and character.",
            ar: "خياركم أحاسنكم أخلاقا",
            fr: "Les meilleurs d'entre vous sont ceux qui ont le meilleur caractère."
        },
        {
            tr: "Veren el, alan elden daha hayırlıdır.",
            en: "The upper hand is better than the lower hand (the one that gives is better than the one that takes).",
            ar: "اليد العليا خير من اليد السفلى",
            fr: "La main qui donne est meilleure que la main qui reçoit."
        }
    ];

    const i18n = {
        tr: { sahur: "Sahur", iftar: "İftar", search: "Ara", placeholder: "Şehir yazın...", leftToIftar: "İftara kalan süre:", leftToSahur: "Sahura kalan süre:", install: "Ana ekrana ekle?", add: "Ekle", hTitle: "Günün Hadisi", dir: "ltr" },
        en: { sahur: "Suhoor", iftar: "Iftar", search: "Search", placeholder: "City name...", leftToIftar: "Until Iftar:", leftToSahur: "Until Suhoor:", install: "Add to Home?", add: "Add", hTitle: "Hadith of the Day", dir: "ltr" },
        ar: { sahur: "السحور", iftar: "الإفطار", search: "بحث", placeholder: "اسم المدينة...", leftToIftar: "الوقت للإفطار:", leftToSahur: "الوقت للسحور:", install: "إضافة للشاشة؟", add: "إضافة", hTitle: "حديث اليوم", dir: "rtl" },
        fr: { sahur: "Suhur", iftar: "Iftar", search: "Chercher", placeholder: "Nom de ville...", leftToIftar: "Jusqu'à l'Iftar:", leftToSahur: "Jusqu'au Suhur:", install: "Ajouter à l'accueil?", add: "Ajouter", hTitle: "Hadith du Jour", dir: "ltr" }
    };

    let currentLang = 'tr';
    let times = { fajr: "", maghrib: "" };
    let deferredPrompt;

    function getDailyHadith() {
        const today = new Date().getDate(); // Ayın günü (1-31)
        const index = (today - 1) % hadithList.length; // Listede döngü kurar
        return hadithList[index];
    }

    function setLang(lang) {
        currentLang = lang;
        const t = i18n[lang];
        const h = getDailyHadith();
        
        document.getElementById('lbl-sahur').innerText = t.sahur;
        document.getElementById('lbl-iftar').innerText = t.iftar;
        document.getElementById('btn-search').innerText = t.search;
        document.getElementById('city-input').placeholder = t.placeholder;
        document.getElementById('lbl-hadith-title').innerText = t.hTitle;
        document.getElementById('hadith-text').innerText = h[lang]; // Günlük hadisi seçilen dilde getir
        document.getElementById('txt-install').innerText = t.install;
        document.getElementById('btn-install-action').innerText = t.add;
        document.getElementById('app').dir = t.dir;
        
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase() === lang));
    }

    async function handleInput(val) {
        const suggBox = document.getElementById('suggestions');
        if (val.length < 3) { suggBox.style.display = 'none'; return; }
        try {
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${val}&limit=5`);
            const data = await res.json();
            suggBox.innerHTML = '';
            if (data.length > 0) {
                suggBox.style.display = 'block';
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerText = item.display_name.split(',')[0] + ', ' + item.display_name.split(',').pop();
                    div.onclick = () => {
                        document.getElementById('city-input').value = div.innerText;
                        suggBox.style.display = 'none';
                        searchCity();
                    };
                    suggBox.appendChild(div);
                });
            }
        } catch(e) {}
    }

    async function searchCity() {
        const city = document.getElementById('city-input').value;
        if (!city) return;
        const res = await fetch(`https://api.aladhan.com/v1/timingsByAddress?address=${city}&method=13`);
        const data = await res.json();
        if(data.code === 200) {
            times.fajr = data.data.timings.Fajr;
            times.maghrib = data.data.timings.Maghrib;
            document.getElementById('time-fajr').innerText = times.fajr;
            document.getElementById('time-maghrib').innerText = times.maghrib;
            document.getElementById('display-city').innerText = city.split(',')[0].toUpperCase();
            startCountdown();
        }
    }

    function startCountdown() {
        if(window.timerInt) clearInterval(window.timerInt);
        window.timerInt = setInterval(() => {
            if (!times.fajr) return;
            const now = new Date();
            const parseTime = (t) => {
                const [h, m] = t.split(':');
                let d = new Date(); d.setHours(h, m, 0); return d;
            };

            let target = parseTime(times.maghrib);
            let label = i18n[currentLang].leftToIftar;

            if (now > target) {
                target = parseTime(times.fajr);
                if (now > target) target.setDate(target.getDate() + 1);
                label = i18n[currentLang].leftToSahur;
            } else if (now < parseTime(times.fajr)) {
                target = parseTime(times.fajr);
                label = i18n[currentLang].leftToSahur;
            }

            const diff = target - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);

            document.getElementById('countdown-label').innerText = label;
            document.getElementById('timer').innerText = 
                `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }, 1000);
    }

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault(); deferredPrompt = e;
        document.getElementById('install-banner').style.display = 'flex';
    });

    async function installApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') document.getElementById('install-banner').style.display = 'none';
            deferredPrompt = null;
        }
    }

    setLang('tr');
    document.getElementById('city-input').value = "Eskisehir";
    searchCity();
</script>

</body>
</html>